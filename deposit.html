<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wallet | QuantumBot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .progress-bar {
            width: 0%;
            transition: width 7s linear;
        }
        .processing .progress-bar {
            width: 100%;
        }
        .crypto-icon {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        .btc-bg {
            background-color: #f7931a;
        }
        .usdt-bg {
            background-color: #26a17b;
        }
        #mobile-menu {
            transition: all 0.3s ease;
            max-height: 0;
            overflow: hidden;
        }
        #mobile-menu:not(.hidden) {
            max-height: 500px;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 font-sans antialiased">
    <!-- Navigation Bar -->
    <nav class="bg-gray-800 border-b border-gray-700 py-3 px-6 flex justify-between items-center">
        <div class="flex items-center space-x-2">
            <a href="index.html" class="flex items-center space-x-2">
                <div class="w-10 h-10 rounded-lg bg-purple-600 flex items-center justify-center">
                    <i class="fas fa-robot text-white text-xl"></i>
                </div>
                <span class="text-xl font-bold">Quantum<span class="text-transparent bg-clip-text bg-gradient-to-r from-purple-500 to-pink-500">Bot</span></span>
            </a>
        </div>
        
        <div class="hidden md:flex items-center space-x-6">
            <a href="dashboard.html" class="px-3 py-2 text-gray-300 hover:text-purple-400 flex items-center">
                <i class="fas fa-tachometer-alt mr-2"></i> Dashboard
            </a>
            <a href="index.html" class="px-3 py-2 text-gray-300 hover:text-purple-400 flex items-center">
                <i class="fas fa-chart-line mr-2"></i> Trading
            </a>
            <a href="deposit.html" class="px-3 py-2 text-gray-300 hover:text-purple-400 flex items-center">
                <i class="fas fa-money-bill-wave mr-2"></i> Deposit
            </a>
            <div class="flex items-center space-x-2 bg-gray-700 px-4 py-2 rounded-lg">
                <i class="fas fa-wallet text-purple-400"></i>
                <span id="wallet-balance">$0.00</span>
            </div>
            <div class="flex items-center space-x-2">
                <i class="fas fa-user-circle text-xl text-purple-400"></i>
                <span id="username-display">Guest</span>
            </div>
            <a href="logout.html" class="px-3 py-2 text-gray-300 hover:text-red-400 flex items-center">
                <i class="fas fa-sign-out-alt mr-2"></i> Logout
            </a>
        </div>
        
        <button id="mobile-menu-button" class="md:hidden text-2xl focus:outline-none">
            <i class="fas fa-bars"></i>
        </button>
    </nav>

    <!-- Mobile Menu -->
    <div id="mobile-menu" class="md:hidden hidden bg-gray-800 border-b border-gray-700 px-6 py-3">
        <div class="flex flex-col space-y-4">
            <a href="dashboard.html" class="px-3 py-2 text-gray-300 hover:text-purple-400 flex items-center">
                <i class="fas fa-tachometer-alt mr-2"></i> Dashboard
            </a>
            <a href="index.html" class="px-3 py-2 text-gray-300 hover:text-purple-400 flex items-center">
                <i class="fas fa-chart-line mr-2"></i> Trading
            </a>
            <a href="deposit.html" class="px-3 py-2 text-gray-300 hover:text-purple-400 flex items-center">
                <i class="fas fa-money-bill-wave mr-2"></i> Deposit
            </a>
            <div class="flex items-center space-x-2 bg-gray-700 px-4 py-2 rounded-lg">
                <i class="fas fa-wallet text-purple-400"></i>
                <span id="mobile-wallet-balance">$0.00</span>
            </div>
            <div class="flex items-center space-x-2">
                <i class="fas fa-user-circle text-xl text-purple-400"></i>
                <span id="mobile-username-display">Guest</span>
            </div>
            <a href="logout.html" class="px-3 py-2 text-gray-300 hover:text-red-400 flex items-center">
                <i class="fas fa-sign-out-alt mr-2"></i> Logout
            </a>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container mx-auto px-4 py-8">
        <!-- Rest of your wallet page content remains exactly the same -->
        <div class="max-w-4xl mx-auto">
            <div class="flex justify-between items-center mb-8">
                <h1 class="text-2xl md:text-3xl font-bold">
                    <i class="fas fa-wallet text-purple-400 mr-3"></i>
                    Wallet
                </h1>
                <div class="flex space-x-2">
                    <button id="refresh-btn" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg flex items-center">
                        <i class="fas fa-sync-alt mr-2"></i> Refresh
                    </button>
                    <button id="deposit-btn" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg flex items-center disabled">
                        <i class="fas fa-plus-circle mr-2"></i> Deposit
                    </button>
                </div>
            </div>
            
            <!-- Balance Cards -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                <div class="bg-gray-800 border border-gray-700 rounded-xl p-6">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-gray-400 text-sm">Total Balance</p>
                            <h3 class="text-2xl font-bold" id="total-balance">$0.00</h3>
                        </div>
                        <div class="bg-purple-600 p-3 rounded-lg">
                            <i class="fas fa-coins text-white"></i>
                        </div>
                    </div>
                    <div class="mt-4 pt-4 border-t border-gray-700">
                        <p class="text-green-400 text-sm flex items-center">
                            <i class="fas fa-arrow-up mr-1"></i> 
                            <span id="total-profit">$0.00</span> total profit
                        </p>
                    </div>
                </div>
                
                <div class="bg-gray-800 border border-gray-700 rounded-xl p-6">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-gray-400 text-sm">Available</p>
                            <h3 class="text-2xl font-bold" id="available-balance">$0.00</h3>
                        </div>
                        <div class="bg-green-600 p-3 rounded-lg">
                            <i class="fas fa-hand-holding-usd text-white"></i>
                        </div>
                    </div>
                    <div class="mt-4 pt-4 border-t border-gray-700">
                        <p class="text-sm">
                            <span id="win-rate">0%</span> win rate (<span id="win-count">0</span>/<span id="total-trades">0</span>)
                        </p>
                    </div>
                </div>
                
                <div class="bg-gray-800 border border-gray-700 rounded-xl p-6">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-gray-400 text-sm">In Trades</p>
                            <h3 class="text-2xl font-bold" id="active-trades">$0.00</h3>
                        </div>
                        <div class="bg-blue-600 p-3 rounded-lg">
                            <i class="fas fa-exchange-alt text-white"></i>
                        </div>
                    </div>
                    <div class="mt-4 pt-4 border-t border-gray-700">
                        <p class="text-sm">
                            <i class="fas fa-btc mr-1"></i>
                            <span id="btc-address">Loading...</span>
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- Transaction Tabs -->
            <div class="bg-gray-800 border border-gray-700 rounded-xl overflow-hidden mb-8">
                <div class="border-b border-gray-700">
                    <div class="flex">
                        <button id="deposit-tab" class="flex-1 py-4 px-6 text-center font-medium border-b-2 border-purple-500 text-purple-400">
                            <i class="fas fa-plus-circle mr-2"></i> Deposit
                        </button>
                        <button id="withdraw-tab" class="flex-1 py-4 px-6 text-center font-medium text-gray-400 hover:text-purple-400">
                            <i class="fas fa-minus-circle mr-2"></i> Withdraw
                        </button>
                        <button id="history-tab" class="flex-1 py-4 px-6 text-center font-medium text-gray-400 hover:text-purple-400">
                            <i class="fas fa-history mr-2"></i> History
                        </button>
                    </div>
                </div>
                
                <!-- Deposit Panel -->
                <div id="deposit-panel" class="p-6">
                    <div class="mb-6">
                        <h3 class="text-lg font-medium mb-4">Select Deposit Method</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <button data-currency="BTC" class="deposit-method-btn flex items-center p-4 border border-gray-700 rounded-lg hover:border-purple-500 transition-colors">
                                <div class="crypto-icon btc-bg mr-3">
                                    <i class="fab fa-btc text-white"></i>
                                </div>
                                <div class="text-left">
                                    <p class="font-medium">Bitcoin (BTC)</p>
                                    <p class="text-sm text-gray-400">Deposit with Bitcoin</p>
                                </div>
                            </button>
                            <button data-currency="USDT" class="deposit-method-btn flex items-center p-4 border border-gray-700 rounded-lg hover:border-purple-500 transition-colors">
                                <div class="crypto-icon usdt-bg mr-3">
                                    <i class="fas fa-dollar-sign text-white"></i>
                                </div>
                                <div class="text-left">
                                    <p class="font-medium">Tether (USDT)</p>
                                    <p class="text-sm text-gray-400">ERC-20 Network</p>
                                </div>
                            </button>
                        </div>
                    </div>
                    
                    <!-- BTC Deposit Form -->
                    <div id="btc-deposit-form" class="hidden">
                        <h3 class="text-lg font-medium mb-4">Bitcoin Deposit</h3>
                        <div class="bg-gray-700 p-4 rounded-lg mb-4">
                            <p class="text-sm text-gray-400 mb-2">Your BTC deposit address</p>
                            <div class="flex items-center">
                                <input type="text" id="btc-deposit-address" class="flex-1 bg-gray-800 border border-gray-600 rounded-l-lg px-4 py-2 text-sm font-mono" value="bc1qar0srrr7xfkvy5l643lydnw9re59gtzzwf5mdq" readonly>
                                <button id="copy-btc-address" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-r-lg">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                            <p class="text-xs text-gray-400 mt-2">
                                <i class="fas fa-info-circle mr-1"></i> Send only BTC to this address. Sending other assets may result in permanent loss.
                            </p>
                        </div>
                        
                        <div class="bg-gray-700 p-4 rounded-lg">
                            <div class="flex justify-between items-center mb-2">
                                <p class="text-sm text-gray-400">Minimum deposit</p>
                                <p class="font-medium">0.0005 BTC</p>
                            </div>
                            <div class="flex justify-between items-center mb-2">
                                <p class="text-sm text-gray-400">Expected arrival</p>
                                <p class="font-medium">3 network confirmations</p>
                            </div>
                            <div class="flex justify-between items-center">
                                <p class="text-sm text-gray-400">Processing fee</p>
                                <p class="font-medium">0%</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- USDT Deposit Form -->
                    <div id="usdt-deposit-form" class="hidden">
                        <h3 class="text-lg font-medium mb-4">USDT Deposit</h3>
                        <div class="bg-gray-700 p-4 rounded-lg mb-4">
                            <p class="text-sm text-gray-400 mb-2">Your USDT deposit address</p>
                            <div class="flex items-center">
                                <input type="text" id="usdt-deposit-address" class="flex-1 bg-gray-800 border border-gray-600 rounded-l-lg px-4 py-2 text-sm font-mono" value="0x71C7656EC7ab88b098defB751B7401B5f6d8976F" readonly>
                                <button id="copy-usdt-address" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-r-lg">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                            <p class="text-xs text-gray-400 mt-2">
                                <i class="fas fa-info-circle mr-1"></i> Send only USDT (ERC-20) to this address. Sending other assets may result in permanent loss.
                            </p>
                        </div>
                        
                        <div class="bg-gray-700 p-4 rounded-lg">
                            <div class="flex justify-between items-center mb-2">
                                <p class="text-sm text-gray-400">Minimum deposit</p>
                                <p class="font-medium">10 USDT</p>
                            </div>
                            <div class="flex justify-between items-center mb-2">
                                <p class="text-sm text-gray-400">Network</p>
                                <p class="font-medium">Ethereum (ERC-20)</p>
                            </div>
                            <div class="flex justify-between items-center">
                                <p class="text-sm text-gray-400">Processing fee</p>
                                <p class="font-medium">0%</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Withdraw Panel -->
                <div id="withdraw-panel" class="hidden p-6">
                    <div class="mb-6">
                        <h3 class="text-lg font-medium mb-4">Select Withdrawal Method</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <button data-currency="BTC" class="withdraw-method-btn flex items-center p-4 border border-gray-700 rounded-lg hover:border-purple-500 transition-colors">
                                <div class="crypto-icon btc-bg mr-3">
                                    <i class="fab fa-btc text-white"></i>
                                </div>
                                <div class="text-left">
                                    <p class="font-medium">Bitcoin (BTC)</p>
                                    <p class="text-sm text-gray-400">Withdraw to BTC wallet</p>
                                </div>
                            </button>
                            <button data-currency="USDT" class="withdraw-method-btn flex items-center p-4 border border-gray-700 rounded-lg hover:border-purple-500 transition-colors">
                                <div class="crypto-icon usdt-bg mr-3">
                                    <i class="fas fa-dollar-sign text-white"></i>
                                </div>
                                <div class="text-left">
                                    <p class="font-medium">Tether (USDT)</p>
                                    <p class="text-sm text-gray-400">ERC-20 Network</p>
                                </div>
                            </button>
                        </div>
                    </div>
                    
                    <!-- BTC Withdraw Form -->
                    <div id="btc-withdraw-form" class="hidden">
                        <h3 class="text-lg font-medium mb-4">Bitcoin Withdrawal</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm text-gray-400 mb-1">BTC Address</label>
                                <input type="text" id="btc-withdraw-address" class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2" placeholder="Enter your BTC address">
                            </div>
                            
                            <div>
                                <label class="block text-sm text-gray-400 mb-1">Amount (BTC)</label>
                                <div class="relative">
                                    <input type="number" id="btc-withdraw-amount" class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 pr-20" placeholder="0.00">
                                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                        <span class="text-gray-400">BTC</span>
                                    </div>
                                </div>
                                <div class="flex justify-between text-xs text-gray-400 mt-1">
                                    <span>Available: <span id="btc-available">0.00</span> BTC</span>
                                    <button class="text-purple-400 hover:text-purple-300" id="btc-max-btn">Max</button>
                                </div>
                            </div>
                            
                            <div class="bg-gray-700 p-4 rounded-lg">
                                <div class="flex justify-between items-center mb-2">
                                    <p class="text-sm text-gray-400">Network fee</p>
                                    <p class="font-medium">0.0001 BTC</p>
                                </div>
                                <div class="flex justify-between items-center mb-2">
                                    <p class="text-sm text-gray-400">You will receive</p>
                                    <p class="font-medium"><span id="btc-receive-amount">0.00</span> BTC</p>
                                </div>
                                <div class="flex justify-between items-center">
                                    <p class="text-sm text-gray-400">Processing time</p>
                                    <p class="font-medium">1-3 hours</p>
                                </div>
                            </div>
                            
                            <button id="btc-withdraw-submit" class="w-full bg-purple-600 hover:bg-purple-700 py-3 rounded-lg font-medium flex items-center justify-center">
                                <i class="fas fa-paper-plane mr-2"></i> Withdraw BTC
                            </button>
                        </div>
                    </div>
                    
                    <!-- USDT Withdraw Form -->
                    <div id="usdt-withdraw-form" class="hidden">
                        <h3 class="text-lg font-medium mb-4">USDT Withdrawal</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm text-gray-400 mb-1">USDT Address (ERC-20)</label>
                                <input type="text" id="usdt-withdraw-address" class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2" placeholder="Enter your USDT address">
                            </div>
                            
                            <div>
                                <label class="block text-sm text-gray-400 mb-1">Amount (USDT)</label>
                                <div class="relative">
                                    <input type="number" id="usdt-withdraw-amount" class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 pr-20" placeholder="0.00">
                                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                        <span class="text-gray-400">USDT</span>
                                    </div>
                                </div>
                                <div class="flex justify-between text-xs text-gray-400 mt-1">
                                    <span>Available: <span id="usdt-available">0.00</span> USDT</span>
                                    <button class="text-purple-400 hover:text-purple-300" id="usdt-max-btn">Max</button>
                                </div>
                            </div>
                            
                            <div class="bg-gray-700 p-4 rounded-lg">
                                <div class="flex justify-between items-center mb-2">
                                    <p class="text-sm text-gray-400">Network fee</p>
                                    <p class="font-medium">1 USDT</p>
                                </div>
                                <div class="flex justify-between items-center mb-2">
                                    <p class="text-sm text-gray-400">You will receive</p>
                                    <p class="font-medium"><span id="usdt-receive-amount">0.00</span> USDT</p>
                                </div>
                                <div class="flex justify-between items-center">
                                    <p class="text-sm text-gray-400">Processing time</p>
                                    <p class="font-medium">10-30 minutes</p>
                                </div>
                            </div>
                            
                            <button id="usdt-withdraw-submit" class="w-full bg-purple-600 hover:bg-purple-700 py-3 rounded-lg font-medium flex items-center justify-center">
                                <i class="fas fa-paper-plane mr-2"></i> Withdraw USDT
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Processing Modal -->
                <div id="processing-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
                    <div class="bg-gray-800 rounded-xl p-6 max-w-md w-full mx-4">
                        <div class="text-center">
                            <div class="w-16 h-16 bg-purple-600 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-spinner fa-spin text-2xl text-white"></i>
                            </div>
                            <h3 class="text-xl font-medium mb-2" id="processing-title">Processing Withdrawal</h3>
                            <p class="text-gray-400 mb-4" id="processing-message">Please wait while we process your transaction...</p>
                            
                            <div class="h-2 bg-gray-700 rounded-full mb-6 overflow-hidden">
                                <div class="progress-bar h-full bg-purple-500"></div>
                            </div>
                            
                            <div class="text-sm text-gray-400 mb-1">
                                <span id="processing-amount">0.00 BTC</span> to <span id="processing-address" class="font-mono truncate inline-block max-w-xs"></span>
                            </div>
                            <div class="text-xs text-gray-500">
                                Transaction ID: <span id="processing-txid" class="font-mono">loading...</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Success Modal -->
                <div id="success-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
                    <div class="bg-gray-800 rounded-xl p-6 max-w-md w-full mx-4 text-center">
                        <div class="w-16 h-16 bg-green-600 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-check text-2xl text-white"></i>
                        </div>
                        <h3 class="text-xl font-medium mb-2">Transaction Successful!</h3>
                        <p class="text-gray-400 mb-4" id="success-message">Your withdrawal has been processed successfully.</p>
                        
                        <div class="bg-gray-700 p-4 rounded-lg mb-4 text-left">
                            <div class="flex justify-between mb-2">
                                <span class="text-gray-400">Amount:</span>
                                <span class="font-medium" id="success-amount">0.00 BTC</span>
                            </div>
                            <div class="flex justify-between mb-2">
                                <span class="text-gray-400">To:</span>
                                <span class="font-mono text-sm" id="success-address">bc1q...wf5mdq</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">TXID:</span>
                                <span class="font-mono text-sm" id="success-txid">a1b2c3...xyz</span>
                            </div>
                        </div>
                        
                        <button id="success-close" class="w-full bg-purple-600 hover:bg-purple-700 py-3 rounded-lg font-medium">
                            Close
                        </button>
                    </div>
                </div>
                
                <!-- History Panel -->
                <div id="history-panel" class="hidden p-6">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-700">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Date</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Type</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Amount</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Status</th>
                                </tr>
                            </thead>
                            <tbody id="transactions-list" class="divide-y divide-gray-700">
                                <!-- Transactions will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                    <div class="px-6 py-4 bg-gray-700 text-sm text-gray-400 flex justify-between items-center">
                        <span id="transaction-count">0 transactions</span>
                        <div class="flex space-x-4">
                            <button id="prev-page" class="disabled:text-gray-600" disabled>Previous</button>
                            <button id="next-page" class="disabled:text-gray-600" disabled>Next</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Mobile menu toggle functionality
        document.addEventListener('DOMContentLoaded', () => {
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            
            mobileMenuButton.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
                
                const icon = mobileMenuButton.querySelector('i');
                if (mobileMenu.classList.contains('hidden')) {
                    icon.classList.remove('fa-times');
                    icon.classList.add('fa-bars');
                } else {
                    icon.classList.remove('fa-bars');
                    icon.classList.add('fa-times');
                }
            });
            
            // Load user data
            loadUserData();
            
            // Tab events
            document.getElementById('deposit-tab').addEventListener('click', () => switchTab('deposit'));
            document.getElementById('withdraw-tab').addEventListener('click', () => switchTab('withdraw'));
            document.getElementById('history-tab').addEventListener('click', () => switchTab('history'));
            
            // Deposit method selection
            document.querySelectorAll('.deposit-method-btn').forEach(btn => {
                btn.addEventListener('click', () => selectDepositMethod(btn.dataset.currency));
            });
            
            // Withdraw method selection
            document.querySelectorAll('.withdraw-method-btn').forEach(btn => {
                btn.addEventListener('click', () => selectWithdrawMethod(btn.dataset.currency));
            });
            
            // Copy address buttons
            document.getElementById('copy-btc-address').addEventListener('click', () => copyToClipboard('btc-deposit-address', 'BTC address copied!'));
            document.getElementById('copy-usdt-address').addEventListener('click', () => copyToClipboard('usdt-deposit-address', 'USDT address copied!'));
            
            // Withdraw form calculations
            document.getElementById('btc-withdraw-amount').addEventListener('input', (e) => {
                const amount = parseFloat(e.target.value) || 0;
                const fee = 0.0001;
                document.getElementById('btc-receive-amount').textContent = (amount - fee).toFixed(6);
            });
            
            document.getElementById('usdt-withdraw-amount').addEventListener('input', (e) => {
                const amount = parseFloat(e.target.value) || 0;
                const fee = 1;
                document.getElementById('usdt-receive-amount').textContent = (amount - fee).toFixed(2);
            });
            
            // Max buttons
            document.getElementById('btc-max-btn').addEventListener('click', () => {
                const available = parseFloat(document.getElementById('btc-available').textContent);
                document.getElementById('btc-withdraw-amount').value = available.toFixed(6);
                document.getElementById('btc-receive-amount').textContent = (available - 0.0001).toFixed(6);
            });
            
            document.getElementById('usdt-max-btn').addEventListener('click', () => {
                const available = parseFloat(document.getElementById('usdt-available').textContent);
                document.getElementById('usdt-withdraw-amount').value = available.toFixed(2);
                document.getElementById('usdt-receive-amount').textContent = (available - 1).toFixed(2);
            });
            
            // Withdraw submit buttons
            document.getElementById('btc-withdraw-submit').addEventListener('click', () => {
                const address = document.getElementById('btc-withdraw-address').value.trim();
                const amount = document.getElementById('btc-withdraw-amount').value;
                
                if (!address) {
                    alert('Please enter a valid BTC address');
                    return;
                }
                
                if (!amount || parseFloat(amount) <= 0) {
                    alert('Please enter a valid amount');
                    return;
                }
                
                const available = parseFloat(document.getElementById('btc-available').textContent);
                if (parseFloat(amount) > available) {
                    alert('Insufficient balance');
                    return;
                }
                
                if (parseFloat(amount) < 0.0005) {
                    alert('Minimum withdrawal is 0.0005 BTC');
                    return;
                }
                
                processWithdrawal('BTC', address, amount);
            });
            
            document.getElementById('usdt-withdraw-submit').addEventListener('click', () => {
                const address = document.getElementById('usdt-withdraw-address').value.trim();
                const amount = document.getElementById('usdt-withdraw-amount').value;
                
                if (!address) {
                    alert('Please enter a valid USDT address');
                    return;
                }
                
                if (!amount || parseFloat(amount) <= 0) {
                    alert('Please enter a valid amount');
                    return;
                }
                
                const available = parseFloat(document.getElementById('usdt-available').textContent);
                if (parseFloat(amount) > available) {
                    alert('Insufficient balance');
                    return;
                }
                
                if (parseFloat(amount) < 10) {
                    alert('Minimum withdrawal is 10 USDT');
                    return;
                }
                
                processWithdrawal('USDT', address, amount);
            });
            
            // Close success modal
            document.getElementById('success-close').addEventListener('click', () => {
                document.getElementById('success-modal').classList.add('hidden');
            });
            
            // Refresh button
            document.getElementById('refresh-btn').addEventListener('click', loadUserData);
            
            // Deposit button (simulated)
            document.getElementById('deposit-btn').addEventListener('click', () => {
                const depositAmount = Math.floor(100 + Math.random() * 400);
                addTransaction('deposit', depositAmount);
                loadUserData();
                
                // Show success message
                alert(`Successfully deposited $${depositAmount.toFixed(2)}`);
            });
        });

        // Load user data from localStorage
        function loadUserData() {
            const currentUserStr = localStorage.getItem('currentUser');
            if (!currentUserStr) {
                window.location.href = 'login.html';
                return;
            }
            
            const currentUser = JSON.parse(currentUserStr);
            
            // Update UI with user data
            document.getElementById('username-display').innerHTML = currentUser.username + 
                (currentUser.role === 'admin' ? ' <span class="text-xs bg-purple-600 text-white px-2 py-1 rounded-full">ADMIN</span>' : '');
            
            document.getElementById('mobile-username-display').innerHTML = currentUser.username + 
                (currentUser.role === 'admin' ? ' <span class="text-xs bg-purple-600 text-white px-2 py-1 rounded-full">ADMIN</span>' : '');
            
            document.getElementById('wallet-balance').textContent = `$${(currentUser.balance || 0).toFixed(2)}`;
            document.getElementById('mobile-wallet-balance').textContent = `$${(currentUser.balance || 0).toFixed(2)}`;
            document.getElementById('total-balance').textContent = `$${(currentUser.balance || 0).toFixed(2)}`;
            document.getElementById('available-balance').textContent = `$${(currentUser.balance || 0).toFixed(2)}`;
            document.getElementById('active-trades').textContent = '$0.00';
            document.getElementById('total-profit').textContent = `$${(currentUser.totalProfit || 0).toFixed(2)}`;
            document.getElementById('win-count').textContent = currentUser.winCount || 0;
            document.getElementById('total-trades').textContent = currentUser.totalTrades || 0;
            document.getElementById('win-rate').textContent = currentUser.totalTrades ? 
                `${Math.round((currentUser.winCount / currentUser.totalTrades) * 100)}%` : '0%';
            
            // Set BTC/USD conversion rate (simulated)
            const btcRate = 50000; // $50,000 per BTC
            const availableBalance = currentUser.balance || 0;
            document.getElementById('btc-available').textContent = (availableBalance / btcRate).toFixed(6);
            document.getElementById('usdt-available').textContent = availableBalance.toFixed(2);
            
            // Load transactions
            loadTransactions(currentUser);
        }
        
        // Load transactions from currentUser data
        function loadTransactions(currentUser) {
            const transactions = currentUser.transactions || [];
            const transactionsList = document.getElementById('transactions-list');
            transactionsList.innerHTML = '';
            
            if (transactions.length === 0) {
                transactionsList.innerHTML = `
                    <tr>
                        <td colspan="4" class="px-6 py-4 text-center text-gray-400">No transactions found</td>
                    </tr>
                `;
            } else {
                transactions.forEach(t => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-700';
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap">
                            ${new Date(t.date).toLocaleString()}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 py-1 rounded-full text-xs font-medium ${
                                t.type === 'deposit' ? 'bg-green-900 text-green-300' : 'bg-purple-900 text-purple-300'
                            }">
                                ${t.type.toUpperCase()}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap ${
                            t.type === 'deposit' ? 'text-green-400' : 'text-purple-400'
                        }">
                            ${t.type === 'deposit' ? '+' : '-'}$${t.amount.toFixed(2)}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 py-1 rounded-full text-xs font-medium bg-gray-600 text-gray-200">
                                Completed
                            </span>
                        </td>
                    `;
                    transactionsList.appendChild(row);
                });
            }
            
            document.getElementById('transaction-count').textContent = 
                `${transactions.length} transaction${transactions.length !== 1 ? 's' : ''}`;
        }

        // Add transaction to user data
        function addTransaction(type, amount) {
            const currentUserStr = localStorage.getItem('currentUser');
            if (!currentUserStr) return null;
            
            const currentUser = JSON.parse(currentUserStr);
            const transaction = {
                id: Date.now(),
                type,
                amount,
                date: new Date().toISOString()
            };
            
            if (!currentUser.transactions) {
                currentUser.transactions = [];
            }
            
            currentUser.transactions.unshift(transaction);
            
            // Update balance if deposit
            if (type === 'deposit') {
                currentUser.balance = (currentUser.balance || 0) + amount;
            } else if (type === 'withdrawal') {
                currentUser.balance = (currentUser.balance || 0) - amount;
            }
            
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            
            // Save to server
            saveUserDataToServer(currentUser);
            
            return transaction;
        }

        // Save user data to server
        async function saveUserDataToServer(userData) {
            const userId = localStorage.getItem('userId');
            if (!userId || !userData) {
                console.error('User ID or user data missing');
                return false;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/save-data`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        userId,
                        userData
                    }),
                });

                if (!response.ok) {
                    throw new Error(`Server returned ${response.status}`);
                }

                const result = await response.json();
                if (!result.success) {
                    console.error('Server reported failure:', result.message);
                    return false;
                }
                
                console.log('User data saved successfully');
                return true;
            } catch (error) {
                console.error('Failed to save user data:', error);
                return false;
            }
        }

        // Process withdrawal
        function processWithdrawal(currency, address, amount) {
            const modal = document.getElementById('processing-modal');
            const title = document.getElementById('processing-title');
            const message = document.getElementById('processing-message');
            const amountDisplay = document.getElementById('processing-amount');
            const addressDisplay = document.getElementById('processing-address');
            
            title.textContent = `Processing ${currency} Withdrawal`;
            message.textContent = `Please wait while we process your ${currency} transaction...`;
            amountDisplay.textContent = `${amount} ${currency}`;
            addressDisplay.textContent = address;
            
            // Generate random TXID
            const txid = `txid_${Math.random().toString(36).substring(2, 15)}${Math.random().toString(36).substring(2, 15)}`;
            document.getElementById('processing-txid').textContent = `${txid.substring(0, 8)}...${txid.substring(txid.length - 4)}`;
            
            // Reset progress bar
            document.querySelector('.progress-bar').style.width = '0%';
            modal.classList.remove('hidden');
            modal.classList.add('processing');
            
            // Simulate processing for 7 seconds
            setTimeout(() => {
                modal.classList.remove('processing');
                modal.classList.add('hidden');
                
                // Show success modal
                const successModal = document.getElementById('success-modal');
                document.getElementById('success-amount').textContent = `${amount} ${currency}`;
                document.getElementById('success-address').textContent = address;
                document.getElementById('success-txid').textContent = `${txid.substring(0, 8)}...${txid.substring(txid.length - 4)}`;
                document.getElementById('success-message').textContent = `Your ${currency} withdrawal has been processed successfully.`;
                successModal.classList.remove('hidden');
                
                // Update balance in localStorage
                const amountValue = parseFloat(amount);
                if (currency === 'BTC') {
                    const btcRate = 50000; // $50,000 per BTC
                    addTransaction('withdrawal', amountValue * btcRate);
                } else {
                    addTransaction('withdrawal', amountValue);
                }
                
                // Refresh UI
                loadUserData();
            }, 7000);
        }

        // Tab switching
        function switchTab(tabName) {
            document.getElementById('deposit-tab').classList.remove('border-purple-500', 'text-purple-400');
            document.getElementById('withdraw-tab').classList.remove('border-purple-500', 'text-purple-400');
            document.getElementById('history-tab').classList.remove('border-purple-500', 'text-purple-400');
            
            document.getElementById('deposit-panel').classList.add('hidden');
            document.getElementById('withdraw-panel').classList.add('hidden');
            document.getElementById('history-panel').classList.add('hidden');
            
            document.getElementById(`${tabName}-tab`).classList.add('border-purple-500', 'text-purple-400');
            document.getElementById(`${tabName}-panel`).classList.remove('hidden');
        }
        
        // Method selection
        function selectDepositMethod(currency) {
            document.getElementById('btc-deposit-form').classList.add('hidden');
            document.getElementById('usdt-deposit-form').classList.add('hidden');
            document.getElementById(`${currency.toLowerCase()}-deposit-form`).classList.remove('hidden');
        }
        
        function selectWithdrawMethod(currency) {
            document.getElementById('btc-withdraw-form').classList.add('hidden');
            document.getElementById('usdt-withdraw-form').classList.add('hidden');
            document.getElementById(`${currency.toLowerCase()}-withdraw-form`).classList.remove('hidden');
        }
        
        // Copy address to clipboard
        function copyToClipboard(elementId, feedback) {
            const element = document.getElementById(elementId);
            element.select();
            document.execCommand('copy');
            
            // Show feedback
            const originalText = element.value;
            element.value = feedback || 'Copied!';
            setTimeout(() => {
                element.value = originalText;
            }, 2000);
        }

        // Update logout functionality
            const logoutLinks = document.querySelectorAll('a[href="logout.html"]');
            logoutLinks.forEach(link => {
                link.addEventListener('click', async (e) => {
                    e.preventDefault();
                    await saveUserDataToServer();
                    localStorage.removeItem('currentUser');
                    localStorage.removeItem('userId');
                    localStorage.removeItem('userEmail');
                    localStorage.clear();
                    window.location.href = 'landingpage.html';
                });
            });
    </script>
</body>
</html>
